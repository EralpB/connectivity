<html>
<body>
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
<script src="http://code.highcharts.com/highcharts.js"></script>
<script src="springy.js"></script>
<script src="springyui.js"></script>

<script>
var first = false;
var graph,springy;
function redraw(p){
if(!first){
first=true;
graph = new Graph();
springy = jQuery('#springydemo').springy({
	graph: graph
});
}

graph.filterEdges(function(){return false;});
graph.filterNodes(function(){return false;});
for(var i = 0;i<100;i++){
	graph.newNode({label:''});
}

for(var source = 0;source<100;source++){
	for(var destination = 0;destination<100;destination++){
		if(Math.random() <= p){
			graph.newEdge(graph.nodes[source],graph.nodes[destination],{directional:false});
		}
	}
}
}


function eralpGraph(vertex_count) {
	var edges = [];
	var vertices = [];
	var visited = [];
	for(var i = 0;i<vertex_count;i++){
		vertices.push(i);
	}
	
	this.findComponent = function(){
		var start_vertex = -1;
		var component_set = [];

		for(var i = 0;i<vertex_count;i++){
			if(visited[i] == false){
				start_vertex = i;
				visited[i] = true;
				break;
			}
		}
		
		if(start_vertex == -1)
			return false;
		
		component_set.push(start_vertex);
		
		var set_size = 1;
		
		do{
			add_size = 0;
			for(var i = 0;i<set_size;i++){
				current_vertex = component_set[i];
				for(var edge_no = 0;edge_no<edges.length;edge_no++){
					if(edges[edge_no][0] == current_vertex && !visited[edges[edge_no][1]])
					{
						component_set.unshift(edges[edge_no][1]);
						visited[edges[edge_no][1]] = true;
						add_size++;
					}else if (edges[edge_no][1] == current_vertex && !visited[edges[edge_no][0]])
					{
						component_set.unshift(edges[edge_no][0]);
						visited[edges[edge_no][0]] = true;
						add_size++;
					}
				}
			}
			set_size = add_size;
		}while(add_size>0);
		
		set_size = component_set.length;
		return set_size;
	}
	
	this.findLargestComponent = function() {
		visited = [];
		for(var i = 0;i<vertex_count;i++){
			visited.push(false);
		}
		
		largest_component_size = -1;
		do{
			var component_size = this.findComponent();
			if(component_size > largest_component_size)
				largest_component_size = component_size;
		}while(component_size)
		return largest_component_size*1.0/vertices.length;
	}
	

	
	this.addEdge = function(source,destination) {
		edges.push([source,destination]);
	}

}

function monteCarloSimulation(iterations,p){
	var sum = 0;
	for(var i = 0;i<iterations;i++){
		var eg = new eralpGraph(100);

		for(var source = 0;source<100;source++){
			for(var destination = 0;destination<100;destination++){
				if(Math.random() <= p){
					eg.addEdge(source,destination);
				}
			}
		}
		sum += eg.findLargestComponent();
	}

	return  (sum)*1.0/iterations;
}
function main(){
	var results =[];
	var probability_list = [];
	
	for(var i = 0;i < 10;i++)
	{
		probability_list.push(i*0.005);
	}
	probability_list.push(1);
	
	for(var i = 0;i < probability_list.length; i++){
		results.push(monteCarloSimulation(50,probability_list[i]));
	}
	console.log(results);
	
	var chart;
	chart = new Highcharts.Chart({
            chart: {
                renderTo: 'container',
                type: 'line',
                marginRight: 130,
                marginBottom: 25
            },
            title: {
                text: 'Largest Component Proportion vs p',
                x: -20 //center
            },
            xAxis: {
                categories: probability_list
            },
            yAxis: {
                title: {
                    text: ''
                },
                plotLines: [{
                    value: 0,
                    width: 1,
                    color: '#808080'
                }]
            },
            tooltip: {
                formatter: function() {
                        return this.x +': '+ this.y;
                }
            },
            legend: {
                layout: 'vertical',
                align: 'right',
                verticalAlign: 'top',
                x: -200,
                y: -200,
                borderWidth: 0
            },
            series: [{
                name: 'Tokyo',
                data: results
            }]
        });
}

</script>
<ul>
<li><a href="#" onclick="main()">Monte Carlo Simulation</a></li>
<li><a href="#" onclick="redraw(0.01)">Visualize Random Graph</a></li>
</ul>
<canvas id="springydemo" width="640" height="480" style="float:left;"></canvas>
<div id="container" style="float:left; min-width: 600px; height: 400px; margin: 0 auto"></div>


</body>
</html>
